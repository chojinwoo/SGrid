var SGrid=function(){var a="bs.SGrid",b=a+".",c=1,d=40,f={width:500,height:500,check:!0,count:!0,title:"",dataRepo:"local",btn:{upd:!1,ins:!1,del:!1,find:!0,refresh:!0,excel:!1}},g=function(){function e(a,b){var d=c;this.init_data(b),this.init(a,b),this.btnEvent(a,b,d),this.callbackEvent(a,b,d),this.toggleEvent(a,d),this.checkEvent(d),b.resize&&this.resizeEvent(a,b),b.lazy&&this.lazyEvent(b,d),c++}return e.prototype.init_data=function(a){a.NOWDATA||("auto"==a.width&&(a.width=$(window).width()-25),a.ORIDATA=[],"local"==a.dataRepo&&(a.ORIDATA=a.data,a.NOWDATA=a.ORIDATA),"http"==a.dataRepo&&$.ajax({url:a.data,type:"post",dataType:"json",async:!1,success:function(b){a.ORIDATA=b,a.NOWDATA=b},error:function(a,b,c){alert("Json load Error : "+c)}}));var b=0;for(var c in a.header){var d=0;"hide"!=a.colsType[c]&&(b+=a.colsWidth[c])}d=a.width-b,a.check&&(d-=40),a.count&&(d-=40),a.surplus=d},e.prototype.init=function(a,b){var e=c,f=new Array;f.push('<div class="SGrid" style="height:'+b.height+"px; width:"+b.width+'px;">'),f.push('<table id="SGrid-table'+e+'" class="SGrid-table">'),f.push(this.init_header(b)),f.push(this.init_body(b)),f.push(this.init_foot(b)),f.push("</table>"),f.push("</div>"),$(a).css("position","relative").append('<div style="width:'+b.width+'px" id="SGrid-title'+e+'" class="SGrid-title" style="height:'+d+'px"><strong>'+b.title+'</strong><i class="fa fa-chevron-circle-down SGrid-toggle" id="SGrid-toggle'+e+'"></i></div>'),$(a).append(f.join(""))},e.prototype.lazyEvent=function(a,b){var c=0;$("#SGrid-table"+b).closest(".SGrid").scroll(function(){var d=$(this).scrollTop(),e=$("#SGrid-table"+b).find("tbody tr:last").index()+1,f=e+5;if(a.NOWDATA.length<=f&&(f=a.NOWDATA.length),c<d){for(var g=new Array,h=e;h<f;h++){g.push("<tr>"),a.count&&g.push('<td class="SGrid-state">'+(Number(h)+1)+"</td>"),a.check&&g.push('<td class="SGrid-check"><input type="checkbox"/></td>');for(var i=0,j=0;j<a.cols.length;j++){var k=0;if("hide"!=a.colsType[j]&&(i+=a.colsWidth[j]),a.colsWidth.length==Number(j)+1&&(k=a.width-i,a.check&&(k-=40),a.count&&(k-=40)),a.surplus=k,"hide"==a.colsType[j]&&g.push('<td style="text-align:'+a.colsAlign[j]+";width:"+a.colsWidth[j]+'px; display:none" col="'+a.cols[j]+'">'+a.NOWDATA[h][a.cols[j]]+"</td>"),"text"==a.colsType[j]&&g.push('<td style="text-align:'+a.colsAlign[j]+";width:"+a.colsWidth[j]+'px;" col="'+a.cols[j]+'">'+a.NOWDATA[h][a.cols[j]]+"</td>"),"object"==typeof a.colsType[j]&&g.push('<td style="text-align:'+a.colsAlign[j]+";width:"+a.colsWidth[j]+'px;" col="'+a.cols[j]+'" data-select-cd="'+a.NOWDATA[h][a.cols[j]]+'">'+a.colsType[j].select[a.NOWDATA[h][a.cols[j]]]+"</td>"),"checkbox"==a.colsType[j]){var l="";a.NOWDATA[h][a.cols[j]]&&(l="checked"),g.push('<td style="text-align:'+a.colsAlign[j]+";width:"+a.colsWidth[j]+'px;"><input name="'+a.cols[j]+'" col="'+a.cols[j]+'" type="checkbox" '+l+" disabled></td>")}}a.surplus>0&&g.push('<td style="width:'+a.surplus+'px"></td>'),g.push("</tr>")}$("#SGrid-table"+b).find("tbody").append(g.join(""))}c=$(this).scrollTop()})},e.prototype.resizeEvent=function(a,b){$(window).resize(function(){var c=$(window).width()-20;b.width=c,e.prototype.init_data(b),$(a).find(".SGrid-title").css("width",c+"px"),$(a).find(".SGrid").css("width",c+"px"),$(a).find("tfoot").css("width",c+"px"),$(a).find("tbody").css("width",c+"px"),$(a).find("thead").css("width",c+"px"),$(a).find("thead tr:first-child th:last-child").css("width",b.surplus+"px"),$(a).find("tbody tr td:last-child").css("width",b.surplus+"px")})},e.prototype.reMapping=function(a,b){new e(a,b)},e.prototype.reFresh=function(a,b){$("#SGrid-table"+b).find("tbody").remove(),$("#SGrid-table"+b).find("thead").after(this.init_body(a)),$("#SGrid-table"+b).find("tbody tr:first-child td").css("padding-top",$("#SGrid-table"+b).find("thead").height()+"px"),$("#SGrid-table"+b).closest(".SGrid").scrollTop(0)},e.prototype.toggleEvent=function(a,b){$(a).find("#SGrid-toggle"+b).click(function(){"none"!=$(a).find("#SGrid-table"+b).css("display")?($(this).removeClass("fa-chevron-circle-down").addClass("fa-chevron-circle-up"),$(a).find("#SGrid-table"+b).fadeOut("slow"),$(a).find(".SGrid").fadeOut("slow"),$(this).parent().addClass("SGrid-title-active")):($(this).parent().removeClass("SGrid-title-active"),$(this).removeClass("fa-chevron-circle-up").addClass("fa-chevron-circle-down"),$(a).find("#SGrid-table"+b).fadeIn("slow"),$(a).find(".SGrid").fadeIn("slow"))})},e.prototype.checkEvent=function(a){$(document).on("change","#SGrid-table"+a+" .SGrid-check input",function(){var a=$(this).closest("tr"),b=a.find(".SGrid-state").text();"U"==b&&a.empty().html(a.data("ori_data")),"I"==b&&a.remove(),"U"!=b&&"I"!=b&&"D"!=b&&(a.data("seq",b),a.find(".SGrid-state").text("D").css("color","red")),"D"==b&&a.find(".SGrid-state").text(a.data("seq")).css("color","")})},e.prototype.init_header=function(a){var b=new Array;b.push('<thead class="SGrid-header" style="width:'+a.width+'px">'),b.push("<tr>"),a.count&&b.push('<th class="SGrid-state">No</th>'),a.check&&b.push('<th class="SGrid-allCheck"><input type="checkbox"/></th>');for(var c in a.header){var d="";"hide"==a.colsType[c]&&(d="display:none;"),b.push('<th style="width:'+a.colsWidth[c]+"px;"+d+'">'+a.header[c]+"</th>")}return b.push('<th style="width:'+a.surplus+'px"></th>'),b.push("</tr>"),b.push("</thead>"),b.join("")},e.prototype.init_body=function(a){var b=new Array;b.push('<tbody class="SGrid-body" style="width:'+a.width+'px">');var c=a.NOWDATA.length;a.lazy&&Math.round(a.height/20)<c&&(c=Math.round(a.height/20));for(var d=0;d<c;d++){b.push("<tr>"),a.count&&b.push('<td class="SGrid-state">'+(Number(d)+1)+"</td>"),a.check&&b.push('<td class="SGrid-check"><input type="checkbox"/></td>');for(var e=0,f=0;f<a.cols.length;f++){var g=0;if("hide"!=a.colsType[f]&&(e+=a.colsWidth[f]),a.colsWidth.length<=Number(f)+1&&(g=a.width-e,a.check&&(g-=40),a.count&&(g-=40),a.surplus=g),"hide"==a.colsType[f]&&b.push('<td style="text-align:'+a.colsAlign[f]+";width:"+a.colsWidth[f]+'px; display:none" col="'+a.cols[f]+'">'+a.NOWDATA[d][a.cols[f]]+"</td>"),"text"==a.colsType[f]&&b.push('<td style="text-align:'+a.colsAlign[f]+";width:"+a.colsWidth[f]+'px;" col="'+a.cols[f]+'">'+a.NOWDATA[d][a.cols[f]]+"</td>"),"object"==typeof a.colsType[f]&&b.push('<td style="text-align:'+a.colsAlign[f]+";width:"+a.colsWidth[f]+'px;" col="'+a.cols[f]+'" data-select-cd="'+a.NOWDATA[d][a.cols[f]]+'">'+a.colsType[f].select[a.NOWDATA[d][a.cols[f]]]+"</td>"),"checkbox"==a.colsType[f]){var h="";a.NOWDATA[d][a.cols[f]]&&(h="checked"),b.push('<td style="text-align:'+a.colsAlign[f]+";width:"+a.colsWidth[f]+'px;"><input name="'+a.cols[f]+'" col="'+a.cols[f]+'" type="checkbox" '+h+" disabled></td>")}}b.push('<td style="width:'+a.surplus+'px"></td>'),b.push("</tr>")}return b.push("</tbody>"),b.join("")},e.prototype.init_foot=function(a){var b=c,e=new Array,f=a.cols.length;return a.check&&f++,a.count&&f++,e.push('<tfoot style="width:'+a.width+"px; top:"+(a.height+d)+'px">'),e.push("<tr>"),e.push('<td colspan="'+f+'">'),a.btn.ins&&e.push('<i class="fa fa-plus SGrid-btn SGrid-btn-plus'+b+'"></i>'),a.btn.del&&e.push('<i class="fa fa-minus SGrid-btn SGrid-btn-del'+b+'"></i>'),(a.btn.upd||a.btn.ins)&&e.push('<i class="fa fa-save SGrid-btn SGrid-btn-save'+b+'"></i>'),a.btn.find&&e.push('<i class="fa fa-search SGrid-btn SGrid-btn-find'+b+'"></i>'),a.btn.refresh&&e.push('<i class="fa fa-refresh SGrid-btn SGrid-btn-refresh'+b+'"></i>'),a.btn.excel&&e.push('<i class="fa fa-file-excel-o SGrid-btn SGrid-btn-excel'+b+'"></i>'),e.push("</td>"),e.push("</tr>"),e.push("</tfoot>"),e.join("")},e.prototype.btnEvent=function(a,c,d){c.btn.ins&&$(document).on("click",".SGrid-btn-plus"+d,function(){function h(){"text"==c.colsType[i]&&g.push('<td style="width:'+c.colsWidth[i]+'px"><input class="form-control" type="text" col="'+c.cols[i]+'" name="'+c.cols[i]+'"/></td>'),"checkbox"==c.colsType[i]&&g.push('<td style="width:'+c.colsWidth[i]+"px; text-align:"+c.colsAlign[i]+'"><input type="checkbox"  col="'+c.cols[i]+'" name="'+c.cols[i]+'"/></td>'),"object"==typeof c.colsType[i]&&g.push('<td style="width:'+c.colsWidth[i]+'px">'+e._dataObject(c.colsType[i],"",c.cols[i],c.colsWidth[i])+"</td>")}var f=0;$("#SGrid-table"+d).find("td").each(function(){var a=$("#SGrid-table"+d).scrollTop();if($(this).offset().top>a)return f=$(this).closest("tr").index(),f>2&&(f+=5),!1});var g=new Array;g.push("<tr>"),c.count&&g.push('<td class="SGrid-state" style="color:red;">I</td>'),c.check&&g.push('<td class="SGrid-check"><input type="checkbox" checked/></td>');for(var i in c.cols){"object"==typeof c.colsFileInsBtn?c.cols[i]!=c.colsFileInsBtn.mappingCol?h():g.push('<td class="file-td" style="width:'+c.colsWidth[i]+'px;"><input type="file" class="file-input"/><button class="file-btn file-btn-success file-btn-sm">'+c.colsFileInsBtn.text+"</button></td>"):h()}g.push('<td style="width:'+c.surplus+'px"></td>'),g.push("</tr>");var k=$("#SGrid-table"+d).find(".SGrid-body tr:last-child").index(),l=0;k>0?$("#SGrid-table"+d).find(".SGrid-body").find("tr").eq(f).after(g.join("")):$("#SGrid-table"+d).find(".SGrid-body").append(g.join("")),l=$("#SGrid-table"+d).find(".SGrid-body tr:last-child").index(),l+=1,$(a).trigger(b+"ins_after",[l])}),c.btn.del&&$(document).on("click",".SGrid-btn-del"+d,function(){try{if(null==c.key)return alert("option 에 key 가 정의되어 있지 않습니다."),!1;var a=[];$("#SGrid-table"+d+" .SGrid-check :checked").each(function(){var b={},d=$(this).closest("tr").find(".SGrid-state").text();"D"==d&&(b[c.key]=$(this).closest("tr").find("td[col="+c.key+"]").text()),a.push(b)}),a.length>0?c.functional.del(a):alert("삭제할 데이터가 없습니다.")}catch(a){alert("del : "+a)}}),c.btn.upd&&$(document).on("dblclick","#SGrid-table"+d+" tr",function(){var a=$(this),b=a.find(".SGrid-state").text();if("U"!=b&&"D"!=b&&"I"!=b){a.data("ori_data",a.html());for(var d in c.cols){var f=$(this).find("td[col="+c.cols[d]+"]").text();"text"!=c.colsType[d]&&"hide"!=c.colsType[d]||$(this).find("td[col="+c.cols[d]+"]").text("").wrapInner('<input class="form-control" col="'+c.cols[d]+'" name="'+c.cols[d]+'" value="'+f+'">'),"object"==typeof c.colsType[d]&&$(this).find("td[col="+c.cols[d]+"]").text("").wrapInner(e._dataObject(c.colsType[d],$(this).find("td[col="+c.cols[d]+"]").attr("data-select-cd"),c.cols[d])),"checkbox"==c.colsType[d]&&$(this).find("input[col="+c.cols[d]+"]").removeAttr("disabled"),$(this).find(".SGrid-state").text("U").css("color","red"),$(this).find(".SGrid-check input").prop("checked",!0)}}}),(c.btn.upd||c.btn.ins)&&$(document).on("click",".SGrid-btn-save"+d,function(){try{var a=[],b=[],e=new FormData;$("#SGrid-table"+d+" .SGrid-check :checked").each(function(){var d=$(this).closest("tr").find(".SGrid-state").text(),f="",g={};for(var h in c.cols){var i=c.cols[h];f="checkbox"==c.colsType[h]?$(this).closest("tr").find("input[name="+i+"]").prop("checked"):"select"==Object.getOwnPropertyNames(c.colsType[h])[0]?$(this).closest("tr").find("select[name="+i+"]").val():$(this).closest("tr").find("input[name="+i+"]").val(),"I"==d&&(g[i]=f),"U"==d&&(g[i]=f),"object"==typeof c.colsFileInsBtn&&"I"==d&&e.append(i,f)}"object"==typeof c.colsFileInsBtn&&"I"==d&&e.append("file",$(this).closest("tr").find("input[type=file]")[0].files[0]),"U"==d&&b.push(g),"I"==d&&a.push(g)}),a.length>0&&("object"==typeof c.colsFileInsBtn?c.functional.ins(e):c.functional.ins(a)),b.length>0&&c.functional.upd(b),0==b.length&&0==a.length&&alert("저장, 수정할 데이터가 없습니다.")}catch(a){alert("save : "+a)}}),c.btn.find&&($(document).on("click",".SGrid-btn-find"+d,function(){var a=new Array,b=0;c.check&&b++,c.count&&b++,a.push("<tr>"),a.push('<td colspan="'+b+'" class="SGrid-kind-td">'),a.push('<select id="SGrid-kind"  class="form-control">'),a.push("<option></option>");for(var e in c.cols)"hide"!=c.colsType[e]&&a.push('<option value="'+c.cols[e]+'">'+c.header[e]+"</option>");a.push("</select>"),a.push("</td>"),a.push('<td colspan="'+c.cols.length+'" class="SGrid-search-td"">'),a.push('<div style="position:relative;"><input type="text" id="SGrid-search" class="form-control" style="padding-top: 0px;padding-bottom: 0px;"><div class="SGrid-search-close"><span>&times;</span></div></div>'),a.push("</td>"),a.push("</tr>"),$("#SGrid-table"+d).find("thead").append(a.join("")),$("#SGrid-table"+d).find("tbody tr:first-child td").css("padding-top",$("#SGrid-table"+d).find("thead").height()+"px")}),$(document).on("change","#SGrid-table"+d+" #SGrid-kind",function(){var a=$(this).val();for(var b in c.cols)if(c.cols[b]==a)if("object"==typeof c.colsType[b]){var d=Object.getOwnPropertyNames(c.colsType[b]);"select"==d[0]&&($(this).closest("tr").find(".SGrid-search-td").empty(),$(this).closest("tr").find(".SGrid-search-td").append('<div style="position:relative;"><div class="SGrid-search-close"><span>&times;</span></div>'+e._dataObject(c.colsType[b],"","SGrid-search",c.colsWidth[b]))+"</div>")}else $(this).closest("tr").find(".SGrid-search-td").empty(),$(this).closest("tr").find(".SGrid-search-td").append('<div style="position:relative;"><input type="text" id="SGrid-search" class="form-control"  style="padding-top: 0px;padding-bottom: 0px;"><div class="SGrid-search-close"><span>&times;</span></div></div>')}),$(document).on("click","#SGrid-table"+d+" .SGrid-search-close",function(){$(this).closest("tr").remove(),$("#SGrid-table"+d).find("tbody tr:first-child td").css("padding-top",$("#SGrid-table"+d).find("thead").height()+"px"),c.NOWDATA=c.ORIDATA,$("#SGrid-table"+d+" .SGrid-search-td:last").index()>-1?$("#SGrid-table"+d+" .SGrid-search-td").each(function(){$(this).find("#SGrid-search").trigger("change")}):e.prototype.reFresh(c,d)}),$(document).on("change","#SGrid-table"+d+" #SGrid-search",function(){var a=$(this).closest("tr").find(".SGrid-kind-td select").val(),b=$(this).val();if(""!=a&&null!=a){var f=[];$(c.NOWDATA).each(function(){this[a].toString().indexOf(b)>-1&&f.push(this)}),c.NOWDATA=f,e.prototype.reFresh(c,d),$("#SGrid-table"+d).find("tbody tr:first-child td").css("padding-top",$("#SGrid-table"+d).find("thead").height()+"px")}})),c.btn.refresh&&$(document).on("click",".SGrid-btn-refresh"+d,function(){c.NOWDATA=c.ORIDATA,e.prototype.reFresh(c,d)}),c.btn.excel&&$(document).on("click",".SGrid-btn-excel"+d,function(){alert()})},e.prototype.callbackEvent=function(a,c,d){$(document).on("click","#SGrid-table"+d+" tbody tr",function(){var d=$(this).find(".SGrid-state").text();if("U"!=d&&"I"!=d&&"D"!=d){var e={};for(var f in c.cols)"checkbox"!=c.colsType[f]?e[c.cols[f]]=$(this).find("td[col="+c.cols[f]+"]").text():e[c.cols[f]]=$(this).find("input[col="+c.cols[f]+"]").prop("checked");$(a).trigger(b+"data",[e])}}),$(document).on("click","#SGrid-table"+d+" tbody tr",function(){var d=$(this).find(".SGrid-state").text();if("U"!=d&&"I"!=d&&"D"!=d){var e={};for(var f in c.cols)"checkbox"!=c.colsType[f]?e[c.cols[f]]=$(this).find("td[col="+c.cols[f]+"]").text():e[c.cols[f]]=$(this).find("input[col="+c.cols[f]+"]").prop("checked");$(a).trigger(b+"onclick",[e])}})},e._dataObject=function(b,c,d,e){var f=Object.getOwnPropertyNames(b),g=new Array;if("select"==f[0]){g.push('<select col="'+d+'" name="'+d+'" id="'+d+'" style="width:100%;" class="form-control">'),g.push("<option></option>");for(var h in b[f[0]]){var i="";h==c&&(i="selected"),g.push('<option value="'+h+'" '+i+">"+b[f[0]][h]+"</option>")}g.push("</select>")}return g.join("")},e.event=function(a,b,c){a.reData=function(a){b.ORIDATA=a,b.NOWDATA=b.ORIDATA,e.prototype.reFresh(b,c)},a.getColumnValue=function(a,d){var e=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1),f="";return"number"==typeof d&&(b.check&&(d+=1),b.count&&(d+=1),f=e.find("td").eq(d-1).find("input").val()),"string"==typeof d&&(f=e.find("input[col="+d+"]").val()),f},a.setColumnValue=function(a,d,e){var f=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1);"number"==typeof d&&(b.check&&(d+=1),b.count&&(d+=1),f.find("td").eq(d-1).find("input").val(e)),"string"==typeof d&&f.find("input[col="+d+"]").val(e)},a.getColumnText=function(a,d){var e=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1),f="";if("number"==typeof d&&(b.check&&(d+=1),b.count&&(d+=1),f=e.find("td").eq(d-1).text()),"string"==typeof d){var e=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1);f=e.find("td[col="+d+"]").text()}return f},a.setColumnText=function(a,d,e){var f=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1);if("number"==typeof d&&(b.check&&(d+=1),b.count&&(d+=1),"boolean"==typeof e?f.find("td").eq(d-1).find("input").prop("checked",e):f.find("td").eq(d-1).text(e)),"string"==typeof d){var f=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1);"boolean"==typeof e?f.find("input[col="+d+"]").prop("checked",e):f.find("td[col="+d+"]").text(e)}},a.getRowKey=function(a){if(null!=b.key)return"";var d=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1);return d.find("td[col="+b.key+"]").val()},a.getRowData=function(a){var d=$("#SGrid-table"+c).find(".SGrid-body").find("tr").eq(a-1),e={};for(var f in b.cols){var g="";"checkbox"!=b.colsType[f]&&(g=d.find("td[col="+b.cols[f]+"]").text()),"checkbox"==b.colsType[f]&&(g=d.find("input[col="+b.cols[f]+"]").prop("checked")),e[b.cols[f]]=g}return e}},e._jqueryInterface=function(d,g){var h=c,i=this.each(function(){var b=$(this),c=b.data(a),g=$.extend({},f,b.data(),"object"==typeof d&&d);d=g,c||b.data(a,c=new e(this,g))});return e.event(i,d,h),i},e}();$.fn.SGrid=g._jqueryInterface,$.fn.SGrid.constructor=g}(jQuery);